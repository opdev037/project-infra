# 全局配置
global:
  domain: bukenon.duckdns.org
  namespace: web-app

# Backend (Laravel API) 配置
backend:
  name: api
  replicaCount: 2
  
  image:
    repository: opdev037/project-api
    tag: latest
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  
  env:
    - name: APP_NAME
      value: "Japanese Learning API"
    - name: APP_ENV
      value: "production"
    - name: APP_DEBUG
      value: "false"
    - name: APP_URL
      value: "http://bukenon.duckdns.org"
    - name: FRONTEND_URL
      value: "http://bukenon.duckdns.org"
    - name: DB_CONNECTION
      value: "mysql"
    - name: DB_HOST
      value: "mysql"
    - name: DB_PORT
      value: "3306"
    - name: DB_DATABASE
      value: "laravel"
    # Redis 配置
    - name: REDIS_HOST
      value: "redis"
    - name: REDIS_PORT
      value: "6379"
    # Queue 配置
    - name: QUEUE_CONNECTION
      value: "redis"
    - name: CACHE_DRIVER
      value: "redis"
    - name: SESSION_DRIVER
      value: "redis"
  
  # Secret 環境變量（從 Secret 讀取）
  secretEnv:
    - name: APP_KEY
      secretName: app-secrets
      secretKey: app-key
    - name: DB_USERNAME
      secretName: app-secrets
      secretKey: db-username
    - name: DB_PASSWORD
      secretName: app-secrets
      secretKey: db-password
    - name: GOOGLE_CLIENT_ID
      secretName: app-secrets
      secretKey: google-client-id
    - name: GOOGLE_CLIENT_SECRET
      secretName: app-secrets
      secretKey: google-client-secret

# Frontend (Vue 3) 配置
frontend:
  name: frontend
  replicaCount: 2
  
  image:
    repository: opdev037/project-frontend
    tag: latest
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Ingress 配置
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
  hosts:
    - host: bukenon.duckdns.org
      paths:
        - path: /api
          pathType: Prefix
          backend: api
        - path: /sanctum
          pathType: Prefix
          backend: api
        - path: /
          pathType: Prefix
          backend: frontend
  tls:
    - secretName: japanese-learning-tls
      hosts:
        - bukenon.duckdns.org

# MySQL 配置
mysql:
  enabled: true
  image: mysql:8.0
  storageClass: nfs-client
  storageSize: 20Gi

# Redis 配置
redis:
  enabled: true
  image: redis:7-alpine
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Horizon (Queue Worker) 配置
horizon:
  enabled: true
  name: horizon
  replicaCount: 1

  image:
    repository: opdev037/project-horizon
    tag: latest
    pullPolicy: Always

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # 自動擴展配置 (HPA)
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
